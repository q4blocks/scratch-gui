
import ScratchBlocks from 'scratch-blocks';

export const testBlocks = {
    simpleDuplicate: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='event_whenflagclicked' id='3GgSEq2C3!UUHbO~!2wG' x='220' y='272'><next><block type='motion_movesteps' id=':L6MsjJxAuqwuVSw^8oO'><value name='STEPS'><shadow type='math_number' id='TXZwH5e3}+[}[RJz#DH)'><field name='NUM'>10</field></shadow></value><next><block type='motion_turnright' id='BKf`Tu?`rziW2g!-*QpM'><value name='DEGREES'><shadow type='math_number' id='JJ-pr9fYpv$me2!%C=K3'><field name='NUM'>15</field></shadow></value><next><block type='motion_pointindirection' id='#u=Td#wrIT0]I*9N:`s/'><value name='DIRECTION'><shadow type='math_angle' id='!z#aH]hyO|NfSDT]%/;}'><field name='NUM'>90</field></shadow></value><next><block type='motion_movesteps' id='m%)5Z67I8g-ofd@LwgX`'><value name='STEPS'><shadow type='math_number' id='+6ij{vIyaYP{9#X,QV/B'><field name='NUM'>10</field></shadow></value><next><block type='motion_turnright' id='%Cqf}+0Pz[Y^7w~Y{{VT'><value name='DEGREES'><shadow type='math_number' id='atI.x%~WQb$X?s.n8:V*'><field name='NUM'>15</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></xml>",
    simpleDuplicate2: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='event_whenflagclicked' id='o[+*9r6kPW8O,c|7VyMO' x='241' y='165'><next><block type='looks_nextcostume' id='U,j^uxoJ+1PA}`O4Ds,i'><next><block type='motion_movesteps' id='HiF1qve#4!](~aB@xg,g'><value name='STEPS'><shadow type='math_number' id='[YQpbIvnJY@Hb+f#RUQ#'><field name='NUM'>10</field></shadow></value><next><block type='control_wait' id='5H6+d/_q]hJ7njS3,!_}'><value name='DURATION'><shadow type='math_positive_number' id='xa8ltNzQ0cDZ%3T;H@L='><field name='NUM'>1</field></shadow></value><next><block type='looks_nextcostume' id='s!WL@Z;B*oD}?DrVdCM]'><next><block type='motion_movesteps' id='+Y~y#x(DB(CCi$.-IeJ*'><value name='STEPS'><shadow type='math_number' id='L3C60jHNaJYunKzw6}*@'><field name='NUM'>10</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></xml>",
    simpleProcedure: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='procedures_definition' id='fk' x='261' y='157'><statement name='custom_block'><shadow type='procedures_prototype' id='QwGQs'><mutation proccode='DoSomething15' argumentids='[]' argumentnames='null' argumentdefaults='null' warp='false'></mutation></shadow></statement><next><block type='motion_movesteps' id='gB'><value name='STEPS'><shadow type='math_number' id='71'><field name='NUM'>10</field></shadow></value><next><block type='motion_turnright' id='4s'><value name='DEGREES'><shadow type='math_number' id='ZG'><field name='NUM'>15</field></shadow></value></block></next></block></next></block></xml>",
    bug:"<xml xmlns='http://www.w3.org/1999/xhtml'><block type='event_whenflagclicked' id='g=/wRy(`)@n8Qa4T1F;f' x='48' y='84'><next><block type='motion_movesteps' id='wmynGR28-{HdJ;X7[$+c'><value name='STEPS'><shadow type='math_number' id='ZkJ5^H5=bWu;jmIvw*cq'><field name='NUM'>10</field></shadow></value><next><block type='motion_turnright' id='cjw.!-WUB/iERK]YsBvi'><value name='DEGREES'><shadow type='math_number' id=',_a)C]@}maZ#-M(R.ljz'><field name='NUM'>15</field></shadow></value><next><block type='motion_turnleft' id='lZTY?9)Ol,cHpmSg*56}'><value name='DEGREES'><shadow type='math_number' id='0c#IM5op_E#ERYqgo7k0'><field name='NUM'>15</field></shadow></value><next><block type='motion_movesteps' id='e?=Gc9`(TZ)TS`C]x(8W'><value name='STEPS'><shadow type='math_number' id='MB4,JRcaM)joVq6UghHg'><field name='NUM'>10</field></shadow></value><next><block type='motion_turnright' id='.]BD`;o_^(O+;u5_ad=i'><value name='DEGREES'><shadow type='math_number' id='s}L%K,9H1dUeH_hcGhaJ'><field name='NUM'>15</field></shadow></value><next><block type='motion_turnleft' id='*2qSA_IX006CBM$W()tn'><value name='DEGREES'><shadow type='math_number' id='w8NJY!1Nqdke?VS?nFo;'><field name='NUM'>15</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></xml>",

    //duplicate const
    simpleDuplicateConst0: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='procedures_definition' id='leT~#w-nx2P3E0a!:jpf' x='390' y='-337'><statement name='custom_block'><shadow type='procedures_prototype' id='$2+ff:%Xe~0PG9DBu?cO'><mutation proccode='set style to %s color %s % brightness' argumentids='[&quot;9.;X8J8fvxg!TQ9,U.p}&quot;,&quot;16cxh^tj,#}/?FZdu[6E&quot;]' argumentnames='[&quot;c&quot;,&quot;b&quot;]' argumentdefaults='[&quot;&quot;,&quot;&quot;,&quot;&quot;]' warp='false'></mutation><value name='9.;X8J8fvxg!TQ9,U.p}'><shadow type='argument_reporter_string_number' id='[}vXuxyAb}y:Pf]u{In='><field name='VALUE'>c</field></shadow></value><value name='16cxh^tj,#}/?FZdu[6E'><shadow type='argument_reporter_string_number' id='!hp,#=L=vl$AQ4i{9#TJ'><field name='VALUE'>b</field></shadow></value></shadow></statement><next><block type='looks_seteffectto' id='rP0yU%a`)#0-H_[ydMCX'><field name='EFFECT'>COLOR</field><value name='VALUE'><shadow id='E)zu{,2[33_L{qKD}?=6' type='math_number'><field name='NUM'>0</field></shadow><block type='argument_reporter_string_number' id=']fyc+|o4wSda[Lmv6R_/'><field name='VALUE'>c</field></block></value><next><block type='looks_seteffectto' id='DAr+NGVj(?CkO9_q88dR'><field name='EFFECT'>BRIGHTNESS</field><value name='VALUE'><shadow id='EuZK3]K_KS83x2ZvnX0E' type='math_number'><field name='NUM'>0</field></shadow><block type='argument_reporter_string_number' id='?Y@h*]jXPe$dBW(,RudV'><field name='VALUE'>b</field></block></value></block></next></block></next></block></xml>",
    simpleDuplicateConst1: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='event_whenflagclicked' id='GoTQ97j2EJXhLs!EDUM}' x='265' y='-323'><next><block type='looks_hide' id='_#~+WH0Un%_=d?xxXopA'><next><block type='motion_gotoxy' id='|1yB]x7`h.hi6QtA1FW?'><value name='X'><shadow type='math_number' id='RUrxn9h3P?K7h`RJ8M:E'><field name='NUM'>-215</field></shadow></value><value name='Y'><shadow type='math_number' id='rT9E5~S=_Jq8?T*vc_B)'><field name='NUM'>0</field></shadow></value><next><block type='motion_pointindirection' id='z5@=|!!h7C`!!EHvHtqc'><value name='DIRECTION'><shadow type='math_angle' id=';yVi^e^7]n45_aydbsq8'><field name='NUM'>90</field></shadow></value><next><block type='looks_setsizeto' id='V1ov_qAu!RuO}8Owm^.4'><value name='SIZE'><shadow type='math_number' id='uwu,9Z[El0SbkkBNah:6'><field name='NUM'>100</field></shadow></value><next><block type='looks_cleargraphiceffects' id='Fwx)}10L8PT..$2$qHG@'><next><block type='looks_switchcostumeto' id='L;IvI.|)_7q.ELH[=zwV'><value name='COSTUME'><shadow type='looks_costume' id='cIpp{EcDL.ViskzEdm[X'><field name='COSTUME'>square</field></shadow></value><next><block type='control_repeat' id='(4O$sHR,g!3GAhtHeAO;'><value name='TIMES'><shadow type='math_whole_number' id='`@dqITsM6sDg[YHX*yTF'><field name='NUM'>50</field></shadow></value><statement name='SUBSTACK'><block type='motion_gotoxy' id='dE(*@i}W[C0TJvI-lhlk'><value name='X'><shadow id='T-]i|cxdO|~)@RE2Ujk:' type='math_number'><field name='NUM'>-135</field></shadow><block type='operator_random' id='2Dg713)Lye=v2a!$uiO^'><value name='FROM'><shadow type='math_number' id='Y4g_8uO8tLcWvgXJMHxL'><field name='NUM'>-200</field></shadow></value><value name='TO'><shadow type='math_number' id='IoNu+^+@AVd7;q4d7ymZ'><field name='NUM'>200</field></shadow></value></block></value><value name='Y'><shadow type='math_number' id='isUYfvAj]Bn/U]=n2u5l'><field name='NUM'>120</field></shadow></value><next><block type='procedures_call' id='thN+Tlmy/vp9[y%D^]a%'><mutation proccode='set style to %s color %s % brightness' argumentids='[&quot;9.;X8J8fvxg!TQ9,U.p}&quot;,&quot;16cxh^tj,#}/?FZdu[6E&quot;]' warp='false'></mutation><value name='9.;X8J8fvxg!TQ9,U.p}'><shadow type='text' id=')_Afa%q=R-+a8w%4HX3_'><field name='TEXT'>35</field></shadow></value><value name='16cxh^tj,#}/?FZdu[6E'><shadow id='rdjh{RLnVPD!q%Exm35j' type='text'><field name='TEXT'></field></shadow><block type='operator_random' id=',]ElBl{=O#e77NA]+%xx'><value name='FROM'><shadow type='math_number' id='|*hh%:U)r8=]!dIdO/sS'><field name='NUM'>-50</field></shadow></value><value name='TO'><shadow type='math_number' id='PAV68W%Kvv4ReQl}%;G+'><field name='NUM'>50</field></shadow></value></block></value><next><block type='control_create_clone_of' id='n(9_@Y^%f3q8uzw^qFg~'><value name='CLONE_OPTION'><shadow type='control_create_clone_of_menu' id='f2XAnacOoA#hc(fIQ@3,'><field name='CLONE_OPTION'>_myself_</field></shadow></value></block></next></block></next></block></statement><next><block type='looks_switchcostumeto' id='4hqO,PXdDcq.u9)}GJB_'><value name='COSTUME'><shadow type='looks_costume' id='%b6}`Eha0NB:RG,l6:jI'><field name='COSTUME'>triangle</field></shadow></value><next><block type='control_repeat' id='I/%3IxP7a](#sE10V|?@'><value name='TIMES'><shadow type='math_whole_number' id='I6G0Tpz08-taS6{2x81:'><field name='NUM'>50</field></shadow></value><statement name='SUBSTACK'><block type='motion_gotoxy' id='l4v$r[GLJ%6dm4(e|U(W'><value name='X'><shadow id='0A1)gWwvIDTa(JNO;@Xd' type='math_number'><field name='NUM'>-135</field></shadow><block type='operator_random' id='$K[y0-G+)yO[+DB3*;[$'><value name='FROM'><shadow type='math_number' id='kZfO+1OMwE8aO`.cp),u'><field name='NUM'>-200</field></shadow></value><value name='TO'><shadow type='math_number' id='I`.vpGgn/@l8@RdzMVZg'><field name='NUM'>200</field></shadow></value></block></value><value name='Y'><shadow type='math_number' id='+=gc+PzGh3ASP0x(o7X9'><field name='NUM'>60</field></shadow></value><next><block type='procedures_call' id='[S[YVnBe|=xCO}/H@,Ig'><mutation proccode='set style to %s color %s % brightness' argumentids='[&quot;9.;X8J8fvxg!TQ9,U.p}&quot;,&quot;16cxh^tj,#}/?FZdu[6E&quot;]' warp='false'></mutation><value name='9.;X8J8fvxg!TQ9,U.p}'><shadow type='text' id='Ust`1y+J}s]i]]N8v7vK'><field name='TEXT'>35</field></shadow></value><value name='16cxh^tj,#}/?FZdu[6E'><shadow id='@6V#eUNZ;^88NKV?7c4D' type='text'><field name='TEXT'></field></shadow><block type='operator_random' id='*$t;HvOLx;+x14af88{='><value name='FROM'><shadow type='math_number' id='0PB=fTS`%txOyDZN~[sO'><field name='NUM'>-50</field></shadow></value><value name='TO'><shadow type='math_number' id='jhx!aH^,R~db29ja3w9q'><field name='NUM'>50</field></shadow></value></block></value><next><block type='control_create_clone_of' id='*KmiCnyYRMs2A9MeL(c]'><value name='CLONE_OPTION'><shadow type='control_create_clone_of_menu' id='z%91(88}hs3yf9KR7vt_'><field name='CLONE_OPTION'>_myself_</field></shadow></value></block></next></block></next></block></statement><next><block type='looks_switchcostumeto' id=')/Iy!F}tsAW~fp?l)s-w'><value name='COSTUME'><shadow type='looks_costume' id='){RA9_In3%eXGy{,6%F-'><field name='COSTUME'>circle</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block><block type='control_start_as_clone' id=';^A_yDtWBl=[e9X?h3-v' x='901' y='-141'><next><block type='looks_show' id='34#G|!#qC+u?0RL5_l-z'></block></next></block><block type='procedures_definition' id='leT~#w-nx2P3E0a!:jpf' x='921' y='72'><statement name='custom_block'><shadow type='procedures_prototype' id='$2+ff:%Xe~0PG9DBu?cO'><mutation proccode='set style to %s color %s % brightness' argumentids='[&quot;9.;X8J8fvxg!TQ9,U.p}&quot;,&quot;16cxh^tj,#}/?FZdu[6E&quot;]' argumentnames='[&quot;c&quot;,&quot;b&quot;]' argumentdefaults='[&quot;&quot;,&quot;&quot;,&quot;&quot;]' warp='false'></mutation><value name='9.;X8J8fvxg!TQ9,U.p}'><shadow type='argument_reporter_string_number' id='[}vXuxyAb}y:Pf]u{In='><field name='VALUE'>c</field></shadow></value><value name='16cxh^tj,#}/?FZdu[6E'><shadow type='argument_reporter_string_number' id='!hp,#=L=vl$AQ4i{9#TJ'><field name='VALUE'>b</field></shadow></value></shadow></statement><next><block type='looks_seteffectto' id='rP0yU%a`)#0-H_[ydMCX'><field name='EFFECT'>COLOR</field><value name='VALUE'><shadow id='E)zu{,2[33_L{qKD}?=6' type='math_number'><field name='NUM'>0</field></shadow><block type='argument_reporter_string_number' id=']fyc+|o4wSda[Lmv6R_/'><field name='VALUE'>c</field></block></value><next><block type='looks_seteffectto' id='DAr+NGVj(?CkO9_q88dR'><field name='EFFECT'>BRIGHTNESS</field><value name='VALUE'><shadow id='EuZK3]K_KS83x2ZvnX0E' type='math_number'><field name='NUM'>0</field></shadow><block type='argument_reporter_string_number' id='?Y@h*]jXPe$dBW(,RudV'><field name='VALUE'>b</field></block></value></block></next></block></next></block></xml>",
    simpleDuplicateConst2: "<xml xmlns='http://www.w3.org/1999/xhtml'><block type='control_start_as_clone' id=';^A_yDtWBl=[e9X?h3-v' x='901' y='-141'><next><block type='looks_show' id='34#G|!#qC+u?0RL5_l-z'></block></next></block></xml>"
}

const addBlocksToWorkspace = function (workspace, rootBlockXml) {
    const dom = ScratchBlocks.Xml.textToDom(rootBlockXml).firstChild;
    ScratchBlocks.Xml.domToBlock(dom, workspace);
}


const workspaceFromXml = (workspace, xml) => {
    const dom = ScratchBlocks.Xml.textToDom(xml);
    Blockly.Xml.domToWorkspace(dom, workspace);
}

const getTestHints = function (workspace, hintState) {
    const blocksDb = Object.values(workspace.blockDB_);
    const badBlocks = blocksDb.filter(b => !b.isShadow_ && b.type === 'motion_movesteps');
    const procedureDefs = blocksDb.filter(b => !b.isShadow_ && b.type === 'procedures_definition');
    const smellHints = badBlocks.map(b => {
        let oldHint = hintState.hints.find(h => b.id === h.blockId);
        if (oldHint) return oldHint;
        let blockId = b.id;
        let hintId = blockId; //hintId is also block id;

        const hintMenuItems = buildHintContextMenu(DUPLICATE_CODE_SMELL_HINT_TYPE);
        return { type: DUPLICATE_CODE_SMELL_HINT_TYPE, hintId, blockId, hintMenuItems };
    });

    const shareableCodeHints = procedureDefs.map(b => {
        let oldHint = hintState.hints.find(h => b.id === h.blockId);
        if (oldHint) return oldHint;
        let blockId = b.id;
        let hintId = blockId; //hintId is also block id;

        const hintMenuItems = buildHintContextMenu(SHAREABLE_CODE_HINT_TYPE);
        return { type: SHAREABLE_CODE_HINT_TYPE, hintId, blockId, hintMenuItems };
    });

    const allHints = [...smellHints, ...shareableCodeHints];

    return allHints;
}

export { addBlocksToWorkspace, getTestHints, workspaceFromXml };